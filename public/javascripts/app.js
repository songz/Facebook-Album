// Generated by CoffeeScript 1.3.3
(function() {
  var dragEnter, dragLeave, drop, getAlbums, navTop, numEnter, prevent, reset, temp, tmpStepMessage;

  navTop = $('.stepMessage').position().top;

  tmpStepMessage = $('#instruction2');

  $(window).scroll(function() {
    var curtop;
    curtop = $(window).scrollTop();
    if (curtop >= navTop) {
      tmpStepMessage.show();
      return $('#instruction').css('opacity', 0);
    } else {
      tmpStepMessage.hide();
      return $('#instruction').css('opacity', 1);
    }
  });

  drop = function(evt) {
    var file, files, formData, url, xhr, _i, _len, _results;
    $('#coverOverlay').hide();
    evt.stopPropagation();
    evt.preventDefault();
    files = evt.dataTransfer.files;
    url = "https://graph.facebook.com" + $('.selectAlbum').attr('id') + "/photos";
    _results = [];
    for (_i = 0, _len = files.length; _i < _len; _i++) {
      file = files[_i];
      formData = new FormData();
      formData.append('access_token', window.fbAccessToken);
      formData.append(file.name, file);
      xhr = new XMLHttpRequest();
      xhr.open("POST", url, true);
      _results.push(xhr.send(formData));
    }
    return _results;
  };

  prevent = function(evt) {
    evt.stopPropagation();
    return evt.preventDefault();
  };

  dragEnter = function(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    $('#coverOverlay').show();
    return numEnter += 1;
  };

  dragLeave = function(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    numEnter -= 1;
    if (numEnter === 0) {
      return $('#coverOverlay').hide();
    }
  };

  reset = function(evt) {
    var numEnter;
    evt.stopPropagation();
    evt.preventDefault();
    $('#coverOverlay').hide();
    return numEnter = 0;
  };

  numEnter = 0;

  document.addEventListener("dragenter", dragEnter, false);

  document.addEventListener("dragleave", dragLeave, false);

  document.addEventListener("dragend", reset, false);

  document.addEventListener("dragover", prevent, false);

  document.addEventListener("drop", drop, false);

  getAlbums = function(response) {
    var album, newDiv, newImg, newa, newp, _i, _len, _ref, _results;
    _ref = response.data;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      album = _ref[_i];
      newDiv = $('<div />', {
        "class": 'albumImg',
        coverPhoto: album.cover_photo,
        id: album.id
      });
      newa = $('<span />', {
        href: '#',
        "class": 'thumbnail'
      });
      newp = $('<p />', {
        text: album.name
      });
      newImg = $('<img />', {
        src: "http://placehold.it/360x180"
      });
      newa.append(newp);
      newa.append(newImg);
      newDiv.append(newa);
      $('#albumStep').append(newDiv);
      newDiv.click(function() {
        $('.selectedAlbum').removeClass('selectedAlbum');
        $(this).addClass('selectedAlbum');
        return $('#instruction').text('Drag Pictures here!');
      });
      _results.push(FB.api("/" + album.cover_photo, function(response2) {
        var img;
        img = $('.albumImg[coverPhoto=' + response2.id + "]").find('img');
        return img.attr('src', response2.source);
      }));
    }
    return _results;
  };

  $('#createAlbum').click(function() {
    return FB.api('/me/albums', 'post', {
      name: 'testAlbum',
      description: 'Album is created as a test from the HACK FOR CHANGE'
    }, function(response) {});
  });

  $('#fblogout').click(function() {
    return FB.logout(function() {
      $('#fblogin').show();
      return $('#fblogout').hide();
    });
  });

  $('#fblogin').click(function() {
    return FB.login(function(response) {
      if (response.authResponse) {
        $('#fblogout').show();
        return $('#fblogin').hide();
      } else {
        return alert("Please Allow");
      }
    }, {
      scope: 'publish_stream'
    });
  });

  window.fbAsyncInit = function() {
    return FB.init({
      appId: '132631233489866',
      status: true,
      cookie: true,
      xfbml: true
    }, FB.Event.subscribe('auth.statusChange', function(response) {
      if (response.status !== "connected") {
        $('#fblogin').show();
        return $('#fblogout').hide();
      } else {
        window.fbAccessToken = response.authResponse.accessToken;
        FB.api('/me/albums', getAlbums);
        $('#fblogout').show();
        return $('#fblogin').hide();
      }
    }));
  };

  temp = function(d) {
    var id, js, ref;
    js = "";
    id = 'facebook-jssdk';
    ref = d.getElementsByTagName('script')[0];
    if (d.getElementById(id)) {
      return;
    }
    js = d.createElement('script');
    js.id = id;
    js.async = true;
    js.src = "//connect.facebook.net/en_US/all.js";
    ref.parentNode.insertBefore(js, ref);
    return "success";
  };

  temp(document);

}).call(this);
